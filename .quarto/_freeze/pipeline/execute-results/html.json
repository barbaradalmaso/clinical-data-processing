{
  "hash": "6eeacb7b078368bde8ef9e868df11481",
  "result": {
    "markdown": "---\ntitle: \"Clinical Data Transformation Pipeline\"\nformat: html\ntoc: true\ntoc-depth: 4\n---\n\n\nQuick links: [SDTM](##sdtm-domains-overview) \\| [ADaM](#adam-overview) \\| [TLGs](#tgls-overview)\n\n## SDTM Domains Overview\n\nThe SDTM (Study Data Tabulation Model) organizes clinical trial data into standardized domains, facilitating analysis and reporting. Each domain captures specific information about study participants, such as demographics, medical history, clinical assessments, and laboratory results.\n\n### Demographics (DM) domain\n\nThis domain contains basic participant information, as:\n\n-   `USUBJID`: Unique subject identifier.\n-   `AGE`: Participant's age.\n-   `SEX`: Sex (Male/Female).\n-   `RACE`: Race (White/Non-white).\n-   `ARM` / `ARMCD`: Treatment arm assigned.\n\nTo transform raw clinical data into a DM domain, the code was run as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)\nlibrary(lubridate) \n\n# Load aids dataset (obtained at Kaggle: https://www.kaggle.com/datasets/tanshihjen/aids-clinical-trials)\naids_df <- read_csv(\"C:/Users/a282334/OneDrive - Syneos Health/Documents/R studies/20250902/AIDS_ClinicalTrial_GroupStudy175.csv\")\n\n# The aids_df is a hypothetical clinical trial data set. So first, I'll adapt it to be similar to a SDTM, by doing derivations\n\ndm <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    AGE = age,\n    SEX = dplyr::case_when(\n      gender == 0 ~ \"F\",\n      gender == 1 ~ \"M\",\n      TRUE ~ NA\n    ),\n    RACE = dplyr::case_when(\n      race == 0 ~ \"WHITE\",\n      race == 1 ~ \"NON-WHITE\",\n      TRUE ~ NA\n    ),\n    ARMCD = dplyr::case_when(\n      trt == 0 ~ \"ZDV\",\n      trt == 1 ~ \"ZDVDDI\",\n      trt == 2 ~ \"ZDVZAL\",\n      trt == 3 ~ \"DDI\",\n      TRUE ~ NA\n    ),\n    ARM = dplyr::case_when(\n      trt == 0 ~ \"Zidovudine (ZDV)\",\n      trt == 1 ~ \"Zidovudine (ZDV) + Didanosine (DDI)\",\n      trt == 2 ~ \"Zidovudine (ZDV) + Zalcitabine (ZAL)\",\n      trt == 3 ~ \"Didanosine (DDI)\",\n      TRUE ~ NA\n    ),\n    WEIGHTBL = wtkg  \n  ) %>%\n  dplyr::select(STUDYID, USUBJID, AGE, SEX, RACE, ARMCD, ARM, WEIGHTBL)\n\n# Save as CSV in your working directory\nwrite.csv(dm, \"dm.csv\", row.names = FALSE)\n\nhead(dm, 6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n  STUDYID USUBJID   AGE SEX   RACE  ARMCD  ARM                          WEIGHTBL\n  <chr>   <chr>   <dbl> <chr> <chr> <chr>  <chr>                           <dbl>\n1 AIDS01  SUBJ-1     48 F     WHITE ZDVZAL Zidovudine (ZDV) + Zalcitab…     89.8\n2 AIDS01  SUBJ-2     61 F     WHITE DDI    Didanosine (DDI)                 49.4\n3 AIDS01  SUBJ-3     45 M     WHITE DDI    Didanosine (DDI)                 88.5\n4 AIDS01  SUBJ-4     47 M     WHITE DDI    Didanosine (DDI)                 85.3\n5 AIDS01  SUBJ-5     43 M     WHITE ZDV    Zidovudine (ZDV)                 66.7\n6 AIDS01  SUBJ-6     46 M     WHITE ZDVDDI Zidovudine (ZDV) + Didanosi…     88.9\n```\n:::\n:::\n\n\n### Medical History (MH) domain\n\nThis domain captures key medical conditions and patient history prior to study start, as:\n\n-   `MHDECOD`: Standardized medical condition term (e.g., Hemophilia).\n-   `MHTERM`: Specific medical history description.\n-   `MHSTRESC`: Recorded status (Yes/No/Unknown).\n\nTo transform raw clinical data into a MH domain, the code was run as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Hemophilia derivation\nmh_hemo <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    MHDECOD = \"HEMOPHILIA\",\n    MHTERM = \"History of Hemophilia\",\n    MHSTRESC = dplyr::case_when(\n      hemo == 0 ~ \"N\",\n      hemo == 1 ~ \"Y\",\n      TRUE ~ NA),\n  ) %>%\n  dplyr::select(STUDYID, USUBJID, MHDECOD, MHTERM, MHSTRESC)\n\n# Sexual orientation derivation\nmh_sex <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    MHDECOD = \"HOMOSEXUAL ACTIVITY\",\n    MHTERM = \"History of Homosexual Activity\",\n    MHSTRESC = dplyr::case_when(\n      homo == 0 ~ \"N\",\n      hemo == 1 ~ \"Y\",\n      TRUE ~ \"Unknown\"),\n  ) %>%\n  dplyr::select(STUDYID, USUBJID, MHDECOD, MHTERM, MHSTRESC)\n\n# History of IV drug use derivation\nmh_drugs <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    MHDECOD = \"INTRAVENOUS DRUG USE\",\n    MHTERM = \"History of IV Drug Use\",\n    MHSTRESC = dplyr::case_when(\n      drugs == 0 ~ \"N\",\n      drugs == 1 ~ \"Y\",\n      TRUE ~ NA),\n  ) %>%\n  dplyr::select(STUDYID, USUBJID, MHDECOD, MHTERM, MHSTRESC)\n\n# History of non-ZDV antiretroviral therapy prior clinical trial\nmh_nzdv <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    MHDECOD = \"NON-ZDV ANTIRETROVIRAL THERAPY\",\n    MHTERM = \"History of non-ZDV antiretroviral therapy\",\n    MHSTRESC = dplyr::case_when(\n      drugs == 0 ~ \"N\",\n      drugs == 1 ~ \"Y\",\n      TRUE ~ NA),\n  ) %>%\n  dplyr::select(STUDYID, USUBJID, MHDECOD, MHTERM, MHSTRESC)\n\n# History of ZDV therapy prior clinical trial\nmh_zdv30 <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    MHDECOD = \"ZDV IN 30 DAYS PRIOR\",\n    MHTERM = \"Zidovudine (ZDV) therapy in 30 days prior to baseline\",\n    MHSTRESC = dplyr::case_when(\n      drugs == 0 ~ \"N\",\n      drugs == 1 ~ \"Y\",\n      TRUE ~ NA),\n  ) %>%\n  dplyr::select(STUDYID, USUBJID, MHDECOD, MHTERM, MHSTRESC)\n\n# History of ZDV therapy prior clinical trial\nmh_zdv <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    MHDECOD = \"ZDV PRIOR\",\n    MHTERM = \"History of prior Zidovudine (ZDV) therapy\",\n    MHSTRESC = dplyr::case_when(\n      drugs == 0 ~ \"N\",\n      drugs == 1 ~ \"Y\",\n      TRUE ~ NA),\n    ) %>%\n  dplyr::select(STUDYID, USUBJID, MHDECOD, MHTERM, MHSTRESC)\n\n# bind to create a unique domain\nmh <- rbind(mh_drugs, mh_hemo, mh_nzdv,\n            mh_sex, mh_zdv30, mh_zdv)\n\n# Save as CSV in your working directory\nwrite.csv(mh, \"mh.csv\", row.names = FALSE)\n\nhead(mh, 6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  STUDYID USUBJID MHDECOD              MHTERM                 MHSTRESC\n  <chr>   <chr>   <chr>                <chr>                  <chr>   \n1 AIDS01  SUBJ-1  INTRAVENOUS DRUG USE History of IV Drug Use N       \n2 AIDS01  SUBJ-2  INTRAVENOUS DRUG USE History of IV Drug Use N       \n3 AIDS01  SUBJ-3  INTRAVENOUS DRUG USE History of IV Drug Use Y       \n4 AIDS01  SUBJ-4  INTRAVENOUS DRUG USE History of IV Drug Use N       \n5 AIDS01  SUBJ-5  INTRAVENOUS DRUG USE History of IV Drug Use N       \n6 AIDS01  SUBJ-6  INTRAVENOUS DRUG USE History of IV Drug Use Y       \n```\n:::\n:::\n\n\n### Subject Characteristics (SC) domain\n\nThis domain includes baseline assessments and clinical observations, as:\n\n-   `SCTESTCD`: Short code for the assessment (e.g., KARNOFSKY, SYMPTOM).\n-   `SCORRES`: Result of the assessment (numerical or coded).\n-   `SCSTRESC`: Categorical result (e.g., Asymptomatic, Symptomatic).\n-   `SCCAT`: Category of measurement (e.g., Baseline Status, Clinical Status).\n-   `VISIT`: Study visit timepoint.\n\nTo transform raw clinical data into a SC domain, the code was run as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsc_karnof <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    SCTESTCD = \"KARNOFSKY\",\n    SCORRES = karnof,\n    SCORRESU = \"Score\",\n    SCSTRESC = as.character(karnof),\n    SCCAT = \"Baseline Status\",\n    VISIT = \"Baseline\") %>%\n  dplyr::select(STUDYID, USUBJID, SCTESTCD, SCORRES, SCORRESU,\n                SCSTRESC, SCCAT, VISIT)\n\nsc_sympt <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    SCTESTCD = \"SYMPTOM\",\n    SCORRES = symptom,\n    SCORRESU = \"Score\",\n    SCSTRESC = dplyr::case_when(\n      symptom == 0 ~ \"Asymptomatic\",\n      symptom == 1 ~ \"Symptomatic\",\n      TRUE ~ NA),\n    SCCAT = \"Clinical Status\",\n    VISIT = \"Baseline\") %>%\n  dplyr::select(STUDYID, USUBJID, SCTESTCD, SCORRES, SCORRESU,\n                SCSTRESC, SCCAT, VISIT)\n\nsc_arv <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    SCTESTCD = \"ARV_HISTORY\",\n    SCORRES = str2,\n    SCORRESU = NA,\n    SCSTRESC = dplyr::case_when(\n      str2 == 0 ~ \"Naive\",\n      str2 == 1 ~ \"Experienced\",\n      TRUE ~ NA),\n    SCCAT = \"Treatment History\",\n    VISIT = \"Baseline\") %>%\n  dplyr::select(STUDYID, USUBJID, SCTESTCD, SCORRES, SCORRESU,\n                SCSTRESC, SCCAT, VISIT)\n\nsc_treat <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    SCTESTCD = \"TREATMENT_IND\",\n    SCORRES = treat,\n    SCORRESU = NA,\n    SCSTRESC = dplyr::case_when(\n      str2 == 0 ~ \"ZDV only\",\n      str2 == 1 ~ \"Other\",\n      TRUE ~ NA),\n    SCCAT = \"Treatment Assignment\",\n    VISIT = \"Baseline\") %>%\n  dplyr::select(STUDYID, USUBJID, SCTESTCD, SCORRES, SCORRESU,\n                SCSTRESC, SCCAT, VISIT)\n\nsc_offtreat <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    SCTESTCD = \"OFF_TREATMENT\",\n    SCORRES = offtrt,\n    SCORRESU = NA,\n    SCSTRESC = dplyr::case_when(\n      str2 == 0 ~ \"N\",\n      str2 == 1 ~ \"Y\",\n      TRUE ~ NA),\n    SCCAT = \"Treatment Status\",\n    VISIT = \"96+/-5 Weeks\") %>%\n  dplyr::select(STUDYID, USUBJID, SCTESTCD, SCORRES, SCORRESU,\n                SCSTRESC, SCCAT, VISIT)\n\n\n# bind to create a unique domain\nsc <- rbind(sc_arv, sc_karnof, sc_offtreat,\n            sc_sympt, sc_treat)\n\n# Save as CSV in your working directory\nwrite.csv(sc, \"sc.csv\", row.names = FALSE)\n\nhead(sc, 6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n  STUDYID USUBJID SCTESTCD    SCORRES SCORRESU SCSTRESC    SCCAT           VISIT\n  <chr>   <chr>   <chr>         <dbl> <chr>    <chr>       <chr>           <chr>\n1 AIDS01  SUBJ-1  ARV_HISTORY       0 <NA>     Naive       Treatment Hist… Base…\n2 AIDS01  SUBJ-2  ARV_HISTORY       1 <NA>     Experienced Treatment Hist… Base…\n3 AIDS01  SUBJ-3  ARV_HISTORY       1 <NA>     Experienced Treatment Hist… Base…\n4 AIDS01  SUBJ-4  ARV_HISTORY       1 <NA>     Experienced Treatment Hist… Base…\n5 AIDS01  SUBJ-5  ARV_HISTORY       1 <NA>     Experienced Treatment Hist… Base…\n6 AIDS01  SUBJ-6  ARV_HISTORY       1 <NA>     Experienced Treatment Hist… Base…\n```\n:::\n:::\n\n\n### Exposure (EX) domain\n\nThis domain details study drug administration for each participant, as:\n\n-   `EXTRT`: Treatment name.\n-   `EXTRTCD`: Treatment code.\n-   `EXROUTE`: Administration route (e.g., Oral).\n-   `EXOCCUR`: Indicates whether the dose actually occurred (Y/N).\n-   `EXSTDTC` / `EXENDTC`: Start and end date of exposure.\n\nTo transform raw clinical data into a EX domain, the code was run as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\n\nex_trt <- aids_df %>%\n  mutate(\n    STUDYID = \"AIDS01\",\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    EXTRT = case_when(\n      trt == 0 ~ \"ZDV Only\",\n      trt == 1 ~ \"ZDV + DDI\",\n      trt == 2 ~ \"ZDV + Zal\",\n      trt == 3 ~ \"DDI Only\",\n      TRUE ~ NA_character_\n    ),\n    EXTRTCD = case_when(\n      trt == 0 ~ \"ZDV\",\n      trt == 1 ~ \"ZDVDDI\",\n      trt == 2 ~ \"ZDVZAL\",\n      trt == 3 ~ \"DDI\",\n      TRUE ~ NA_character_\n    ),\n    EXROUTE = \"Oral\",\n    EXSTDTC = as.Date(\"2025-01-01\"),\n    EXOCCUR = case_when(\n      offtrt == 0 ~ \"N\",\n      offtrt == 1 ~ \"Y\"\n    ),\n    EXENDTC = if_else(\n      offtrt == 0,\n      as.Date(\"2025-12-01\"),\n      as.Date(\"2025-01-01\") + sample(28:84, 1)  \n    )\n  ) %>%\n  select(STUDYID, USUBJID, EXTRT, EXTRTCD, EXROUTE, EXSTDTC, EXOCCUR, EXENDTC)\n\n# Save as CSV in your working directory\nwrite.csv(ex_trt, \"ex.csv\", row.names = FALSE)\n\nhead(ex_trt, 6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n  STUDYID USUBJID EXTRT     EXTRTCD EXROUTE EXSTDTC    EXOCCUR EXENDTC   \n  <chr>   <chr>   <chr>     <chr>   <chr>   <date>     <chr>   <date>    \n1 AIDS01  SUBJ-1  ZDV + Zal ZDVZAL  Oral    2025-01-01 N       2025-12-01\n2 AIDS01  SUBJ-2  DDI Only  DDI     Oral    2025-01-01 N       2025-12-01\n3 AIDS01  SUBJ-3  DDI Only  DDI     Oral    2025-01-01 Y       2025-02-28\n4 AIDS01  SUBJ-4  DDI Only  DDI     Oral    2025-01-01 N       2025-12-01\n5 AIDS01  SUBJ-5  ZDV Only  ZDV     Oral    2025-01-01 N       2025-12-01\n6 AIDS01  SUBJ-6  ZDV + DDI ZDVDDI  Oral    2025-01-01 N       2025-12-01\n```\n:::\n:::\n\n\n### Laboratory Tests (LB) domain\n\nThis domain captures laboratory measurements at different visits, as:\n\n-   `LBTESTCD`: Lab test code (e.g., CD4, CD8).\n-   `LBTEST`: Full lab test name.\n-   `LBORRESU`: Unit of measurement (e.g., cells/mm³).\n-   `VISIT`: Visit when the test was performed.\n-   `LBORRES` / `LBSTRESC`: Recorded result (numerical or categorical).\n\nTo transform raw clinical data into a LB domain, the code was run as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlb_cd4 <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    LBTESTCD = \"CD4\",\n    LBTEST = \"CD4+ T-cell Count\",\n    LBORRES = cd40,\n    LBORRESU = \"cells/mm3\",\n    LBSTRESC = as.character(cd40),\n    VISIT = \"Baseline\") %>%\n  dplyr::select(STUDYID, USUBJID, LBTESTCD, LBTEST, LBORRES,\n                LBORRESU, LBSTRESC, VISIT)\n\nlb_cd4_weeks <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    LBTESTCD = \"CD4\",\n    LBTEST = \"CD4+ T-cell Count\",\n    LBORRES = cd420,\n    LBORRESU = \"cells/mm3\",\n    LBSTRESC = as.character(cd420),\n    VISIT = \"20±5 weeks\") %>%\n  dplyr::select(STUDYID, USUBJID, LBTESTCD, LBTEST, LBORRES,\n                LBORRESU, LBSTRESC, VISIT)\n\nlb_cd8 <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    LBTESTCD = \"CD8\",\n    LBTEST = \"CD8+ T-cell Count\",\n    LBORRES = cd80,\n    LBORRESU = \"cells/mm3\",\n    LBSTRESC = as.character(cd80),\n    VISIT = \"Baseline\") %>%\n  dplyr::select(STUDYID, USUBJID, LBTESTCD, LBTEST, LBORRES,\n                LBORRESU, LBSTRESC, VISIT)\n\n\nlb_cd8_weeks <- aids_df %>%\n  dplyr::mutate(\n    STUDYID = \"AIDS01\",  # fixed study identifier\n    USUBJID = paste0(\"SUBJ-\", row_number()),\n    LBTESTCD = \"CD8\",\n    LBTEST = \"CD8+ T-cell Count\",\n    LBORRES = cd820,\n    LBORRESU = \"cells/mm3\",\n    LBSTRESC = as.character(cd820),\n    VISIT = \"20±5 weeks\") %>%\n  dplyr::select(STUDYID, USUBJID, LBTESTCD, LBTEST, LBORRES,\n                LBORRESU, LBSTRESC, VISIT)\n\n# bind to create a unique domain\nlb <- rbind(lb_cd4, lb_cd4_weeks,\n            lb_cd8, lb_cd8_weeks)\n\n# Save as CSV in your working directory\nwrite.csv(lb, \"lb.csv\", row.names = FALSE)\n\nhead(lb, 6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n  STUDYID USUBJID LBTESTCD LBTEST            LBORRES LBORRESU  LBSTRESC VISIT   \n  <chr>   <chr>   <chr>    <chr>               <dbl> <chr>     <chr>    <chr>   \n1 AIDS01  SUBJ-1  CD4      CD4+ T-cell Count     422 cells/mm3 422      Baseline\n2 AIDS01  SUBJ-2  CD4      CD4+ T-cell Count     162 cells/mm3 162      Baseline\n3 AIDS01  SUBJ-3  CD4      CD4+ T-cell Count     326 cells/mm3 326      Baseline\n4 AIDS01  SUBJ-4  CD4      CD4+ T-cell Count     287 cells/mm3 287      Baseline\n5 AIDS01  SUBJ-5  CD4      CD4+ T-cell Count     504 cells/mm3 504      Baseline\n6 AIDS01  SUBJ-6  CD4      CD4+ T-cell Count     235 cells/mm3 235      Baseline\n```\n:::\n:::\n\n\n## ADaM Overview {#adam-overview}\n\nThe ADaM (Analysis Data Model) standard was developed by CDISC to structure clinical trial datasets for statistical analysis. ADaM datasets are derived from SDTM and organized to facilitate statistical programming, as well as the creation of tables, listings, and graphs (TLGs) - more details below. They follow strict rules for traceability, ensuring that every variable can be linked back to its source in SDTM.\n\n### Subject-Level Analysis Dataset (ADSL)\n\n**ADSL** contains one record per subject and provides key demographic and treatment information that serves as the foundation for most analyses. Its main characteristics include:\n\n-   Structure: one record per subject.\n-   Key variables: `STUDYID`, `USUBJID`, `AGE`, `SEX`, `RACE`, `ARM`, and `ACTARM`.\n-   Includes treatment start and end dates, discontinuation status, and other derived variables useful for subgroup analyses.\n\nTo manually construct *ADSL* data using SDTM domains, the code was run as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load packages\nlibrary(tidyverse)\n\n\n# Load SDTM domains\ndm <- read.csv(\"dm.csv\")\nmh <- read.csv(\"mh.csv\")\nsc <- read.csv(\"sc.csv\")\nex <- read.csv(\"ex.csv\")\nlb <- read.csv(\"lb.csv\")\n\n# -------------------------------------------------------------------------------------------\n# Start from DM (1 line per subject guaranteed)\nadsl <- dm %>%\n  # Merge with SC for baseline Karnofsky and symptoms\n  left_join(\n    sc %>% \n      filter(SCTESTCD == \"KARNOFSKY\", VISIT == \"Baseline\") %>%\n      select(USUBJID, SCORRES) %>%\n      rename(KARNOF = SCORRES),\n    by = \"USUBJID\"\n  ) %>%\n  left_join(\n    sc %>% \n      filter(SCTESTCD == \"SYMPTOM\", VISIT == \"Baseline\") %>%\n      select(USUBJID, SCSTRESC) %>%\n      rename(SYMPTOM = SCSTRESC),\n    by = \"USUBJID\"\n  ) %>%\n  # Merge with MH for key medical history\n  left_join(\n    mh %>%\n      filter(MHDECOD == \"HEMOPHILIA\") %>%\n      select(USUBJID, MHSTRESC) %>%\n      rename(HEMO = MHSTRESC),\n    by = \"USUBJID\"\n  ) %>%\n  left_join(\n    mh %>%\n      filter(MHDECOD == \"INTRAVENOUS DRUG USE\") %>%\n      select(USUBJID, MHSTRESC) %>%\n      rename(IVDRUG = MHSTRESC),\n    by = \"USUBJID\"\n  ) %>%\n  mutate(\n    STUDYID = \"AIDS01\",\n    TRTSDT = as.Date(\"2025-01-01\"),  # treatment start date\n    TRTEDT = as.Date(\"2025-12-01\")   # treatment end date \n  )\n\n# Save ADSL\nwrite.csv(adsl, \"adsl.csv\", row.names = FALSE)\n\n# Preview\nhead(adsl)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  STUDYID USUBJID AGE SEX  RACE  ARMCD                                  ARM\n1  AIDS01  SUBJ-1  48   F WHITE ZDVZAL Zidovudine (ZDV) + Zalcitabine (ZAL)\n2  AIDS01  SUBJ-2  61   F WHITE    DDI                     Didanosine (DDI)\n3  AIDS01  SUBJ-3  45   M WHITE    DDI                     Didanosine (DDI)\n4  AIDS01  SUBJ-4  47   M WHITE    DDI                     Didanosine (DDI)\n5  AIDS01  SUBJ-5  43   M WHITE    ZDV                     Zidovudine (ZDV)\n6  AIDS01  SUBJ-6  46   M WHITE ZDVDDI  Zidovudine (ZDV) + Didanosine (DDI)\n  WEIGHTBL KARNOF      SYMPTOM HEMO IVDRUG     TRTSDT     TRTEDT\n1  89.8128    100 Asymptomatic    N      N 2025-01-01 2025-12-01\n2  49.4424     90 Asymptomatic    N      N 2025-01-01 2025-12-01\n3  88.4520     90 Asymptomatic    N      Y 2025-01-01 2025-12-01\n4  85.2768    100 Asymptomatic    N      N 2025-01-01 2025-12-01\n5  66.6792    100 Asymptomatic    N      N 2025-01-01 2025-12-01\n6  88.9056    100 Asymptomatic    N      Y 2025-01-01 2025-12-01\n```\n:::\n:::\n\n\n### Laboratory Results Analysis Dataset (ADLB)\n\n**ADLB** is the dataset for laboratory test results. It contains repeated measures per subject across study visits, enabling assessment of trends, changes, and treatment-related effects. Its main characteristics include: - Structure: one record per subject per laboratory parameter per visit. - Key variables: `STUDYID`, `USUBJID`, `PARAM`, `AVISIT`, `AVAL`(numeric result), `BASE`, and `CHG` (change from baseline). - Supports analyses such as mean comparisons between treatment arms, evaluation of clinically relevant changes, and categorization of results outside reference ranges.\n\nTo manually construct *ADLB* data using SDTM domains, the code was run as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ADLB\nadlb <- lb %>%\n  left_join(dm %>% select(USUBJID, ARM, ARMCD), by = \"USUBJID\") %>%\n  group_by(USUBJID, LBTESTCD) %>%\n  arrange(VISIT) %>%\n  mutate(\n    PARAMCD = LBTESTCD,\n    PARAM = LBTEST,\n    AVAL = LBORRES,\n    AVALU = LBORRESU\n  ) %>%\n  ungroup() %>%\n  select(STUDYID, USUBJID, ARM, ARMCD, VISIT, PARAMCD, PARAM, AVAL, AVALU)\n\n# Save ADSL\nwrite.csv(adlb, \"adlb.csv\", row.names = FALSE)\n\n# Preview\nhead(adlb)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 9\n  STUDYID USUBJID ARM                      ARMCD VISIT PARAMCD PARAM  AVAL AVALU\n  <chr>   <chr>   <chr>                    <chr> <chr> <chr>   <chr> <int> <chr>\n1 AIDS01  SUBJ-1  Zidovudine (ZDV) + Zalc… ZDVZ… 20±5… CD4     CD4+…   477 cell…\n2 AIDS01  SUBJ-2  Didanosine (DDI)         DDI   20±5… CD4     CD4+…   218 cell…\n3 AIDS01  SUBJ-3  Didanosine (DDI)         DDI   20±5… CD4     CD4+…   274 cell…\n4 AIDS01  SUBJ-4  Didanosine (DDI)         DDI   20±5… CD4     CD4+…   394 cell…\n5 AIDS01  SUBJ-5  Zidovudine (ZDV)         ZDV   20±5… CD4     CD4+…   353 cell…\n6 AIDS01  SUBJ-6  Zidovudine (ZDV) + Dida… ZDVD… 20±5… CD4     CD4+…   339 cell…\n```\n:::\n:::\n\n\n## TGLs Overview {#tgls-overview}\n\nTables, Listings, and Graphs (TLGs) are the final outputs generated from ADaM datasets to support clinical trial reporting. They are designed to provide clear, standardized summaries of study results that can be reviewed by clinicians, statisticians, and regulatory agencies.\n\nThe main objectives of TLGs are:\n\n-   **Tables**: summarize patient characteristics, efficacy, and safety data with descriptive and inferential statistics.\n-   **Listings**: display subject-level data in detail, allowing reviewers to trace back results to individual participants.\n-   **Graphs**: visually represent trends, distributions, and treatment effects to complement tabular summaries.\n\n### TGLs Implemented in this project\n\nIn this pipeline, I created a set of TLGs using **ADSL** (demographics) and **ADLB** (laboratory data):\n\n#### **Demographics and Baseline Characteristics (ADSL)**:\n\n-   Table summarizing sex, age, and race distribution by treatment arm.\n-   Graphs showing proportions of sex and race across arms.\n-   Histogram of age distribution by treatment.\n\nThe code was run as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Finally, I will create tables, graphs and lists (TGLs) using the clinical data \n# Load packages\nlibrary(tidyverse)\nlibrary(rtables)\nlibrary(ggplot2)\n\n\n# Load datasets\nadsl <- read.csv(\"adsl.csv\")\nadlb <- read.csv(\"adlb.csv\")\n\n# ----------------------------------------------------------------------------------------------------\n# Table N per ARMCD/SEX/RACE\n# Change sex labels for graph\nadsl_lbl <- adsl %>%\n  dplyr::mutate(\n    SEX = dplyr::recode(SEX,\n                        \"M\" = \"Male\",\n                        \"F\" = \"Female\"))\n\nadsl_lbl <- adsl_lbl %>%\n  dplyr::mutate(\n    RACE = dplyr::recode(RACE,\n                        \"WHITE\" = \"White\",\n                        \"NON-WHITE\" = \"Non-white\"))\n\n# Create basic rtable\ntbl <- basic_table(show_colcounts = TRUE) %>%\n  split_cols_by(\"ARM\") %>%\n  add_overall_col(\"TOTAL\") %>%\n  split_rows_by(\"SEX\",\n                split_label = \"Subject Sex\",\n                label_pos = \"topleft\") %>%\n  summarize_row_groups() %>%\n  analyze(\"AGE\",\n          var_labels = \"Age (years)\",\n          afun = function(x, .N_col) {\n            m <- mean(x, na.rm = TRUE)\n            med <- median(x, na.rm = TRUE)\n            q1 <- quantile(x, 0.25, na.rm = TRUE)\n            q3 <- quantile(x, 0.75, na.rm = TRUE)\n            mi <- min(x, na.rm = TRUE)\n            ma <- max(x, na.rm = TRUE)\n            \n            in_rows(\n              \"Mean\"     = sprintf(\"%.1f\", m),\n              \"Median\"   = sprintf(\"%.1f\", med),\n              \"Q1\"       = sprintf(\"%.1f\", q1),\n              \"Q3\"       = sprintf(\"%.1f\", q3),\n              \"Min\"      = sprintf(\"%.1f\", mi),\n              \"Max\"      = sprintf(\"%.1f\", ma)\n            )\n          }) %>%\n  analyze(\"RACE\", var_labels = \"Race\",\n          afun = function(x, .N_col) {\n            tab <- table(x)\n            res <- sprintf(\"%d (%.1f%%)\", tab, 100 * tab / .N_col)\n            in_rows(.list = as.list(res), .labels = names(tab))\n          })\n\ntbl_final <- build_table(tbl, adsl_lbl)\n\n# Titles & Footers\nmain_title(tbl_final) <- \"Demographics and Baseline Characteristics of Patients with Acquired Immunodeficiency Syndrome (AIDS) by Treatment Arm.\"\nsubtitles(tbl_final) <- \"Summary of sex, age, and race distribution in the Safety Population.\"\nmain_footer(tbl_final) <- c(\"Mean = arithmetic average; Median = 50th percentile; Q1/Q3 = 25th and 75th percentiles; Min/Max = extreme values.\")\nprov_footer(tbl_final) <- \"Safety Population includes all randomized patients with AIDS who received at least one dose of study treatment.\"\n\ntbl_final\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDemographics and Baseline Characteristics of Patients with Acquired Immunodeficiency Syndrome (AIDS) by Treatment Arm.\nSummary of sex, age, and race distribution in the Safety Population.\n\n———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————\n                Zidovudine (ZDV) + Zalcitabine (ZAL)   Didanosine (DDI)   Zidovudine (ZDV)   Zidovudine (ZDV) + Didanosine (DDI)      TOTAL    \nSubject Sex                   (N=524)                      (N=561)            (N=532)                      (N=522)                   (N=2139)  \n———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————\nFemale                       89 (17.0%)                   91 (16.2%)        100 (18.8%)                  88 (16.9%)                368 (17.2%) \n  Age (years)                                                                                                                                  \n    Mean                        35.0                         35.2               33.6                        33.5                       34.3    \n    Median                      34.0                         35.0               33.0                        32.0                       33.0    \n    Q1                          29.0                         30.0               28.0                        28.0                       28.8    \n    Q3                          40.0                         40.0               38.2                        37.0                       39.0    \n    Min                         18.0                         19.0               17.0                        20.0                       17.0    \n    Max                         57.0                         63.0               52.0                        60.0                       63.0    \n  Race                                                                                                                                         \n    Non-white                51 (9.7%)                    57 (10.2%)         62 (11.7%)                   43 (8.2%)                213 (10.0%) \n    White                    38 (7.3%)                    34 (6.1%)          38 (7.1%)                    45 (8.6%)                 155 (7.2%) \nMale                        435 (83.0%)                  470 (83.8%)        432 (81.2%)                  434 (83.1%)               1771 (82.8%)\n  Age (years)                                                                                                                                  \n    Mean                        35.5                         35.1               35.6                        35.6                       35.4    \n    Median                      34.0                         34.0               35.0                        35.0                       34.0    \n    Q1                          29.0                         29.0               30.0                        30.0                       29.0    \n    Q3                          40.0                         40.0               41.0                        41.0                       40.5    \n    Min                         13.0                         12.0               13.0                        12.0                       12.0    \n    Max                         65.0                         70.0               70.0                        69.0                       70.0    \n  Race                                                                                                                                         \n    Non-white                99 (18.9%)                  116 (20.7%)         94 (17.7%)                  95 (18.2%)                404 (18.9%) \n    White                   336 (64.1%)                  354 (63.1%)        338 (63.5%)                  339 (64.9%)               1367 (63.9%)\n———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————\n\nMean = arithmetic average; Median = 50th percentile; Q1/Q3 = 25th and 75th percentiles; Min/Max = extreme values.\n\nSafety Population includes all randomized patients with AIDS who received at least one dose of study treatment.\n```\n:::\n\n```{.r .cell-code}\n# Graphs\n# Sex percentage per group\nggplot(adsl_lbl, aes(x = ARMCD, fill = SEX)) +\n  geom_bar(position = \"fill\", color = \"white\", width = 0.5, alpha = 0.7) +\n  scale_y_continuous(labels = scales::percent) +\n  scale_fill_manual(values = c(\"Male\" = \"#B3B3B3\", \"Female\" = \"#A6D854\")) +\n  labs(title = \"Sex Distribution by Treatment Arm\",\n       x = \"Treatment Arm\", y = \"Percentage\",\n       fill = \"Sex\") +\n  theme_minimal(base_size = 12) +\n  theme(\n    panel.grid.major.x = element_blank(),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.y = element_line(color = \"grey90\"),\n    legend.position = \"top\",\n    legend.title = element_blank(),\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  )\n```\n\n::: {.cell-output-display}\n![](pipeline_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Race summary\nggplot(adsl_lbl, aes(x = ARMCD, fill = RACE)) +\n  geom_bar(position = \"fill\", color = \"white\", width = 0.5,  alpha = 0.7) +\n  scale_y_continuous(labels = scales::percent) +\n  scale_fill_manual(values = c(\"White\" = \"#66C2A5\", \"Non-white\" = \"#FC8D62\")) +\n  labs(title = \"Race Distribution by Treatment Arm\",\n       x = \"Treatment Arm\", y = \"Percentage\",\n       fill = \"Race\") +\n  theme_minimal(base_size = 12) +\n  theme(\n    panel.grid.major.x = element_blank(),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.y = element_line(color = \"grey90\"),\n    legend.position = \"top\",\n    legend.title = element_blank(),\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  )\n```\n\n::: {.cell-output-display}\n![](pipeline_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Age summary\nggplot(adsl, aes(x = AGE, fill = ARM)) +\n  geom_histogram(binwidth = 5, position = \"dodge\", alpha = 0.7) +\n  scale_fill_brewer(palette = \"Set2\") +  # paleta discreta\n  labs(\n    title = \"Age Distribution by Treatment Arm\",\n    x = \"Age (years)\",\n    y = \"Number of Patients\",\n    fill = \"Treatment Arm\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    legend.position = \"top\",\n    legend.title = element_text(face = \"bold\"),\n    panel.grid.minor = element_blank()\n  )\n```\n\n::: {.cell-output-display}\n![](pipeline_files/figure-html/unnamed-chunk-8-3.png){width=672}\n:::\n:::\n\n\n#### **Laboratory Test Results (ADLB)**:\n\n-   Tables summarizing baseline and follow-up laboratory results (mean, median, quartiles, min/max).\n-   Graph showing proportions T cell count (CD4+ and CD8+) across arms.\n\nThe code was run as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ----------------------------------------------------------------------------------------------------\n# Merge lab data from adsl to adlb\nadlb_merged <- adlb %>%\n  left_join(\n    adsl %>% select(USUBJID, SYMPTOM, HEMO, KARNOF, IVDRUG),\n    by = \"USUBJID\"\n  )\n\nadlb_merged$VISIT <- factor(adlb_merged$VISIT, levels = c(\"Baseline\", \"20±5 weeks\")) # Order patient visit as baseline first\n\n\n# Create basic rtable\ntbl_lab <- basic_table(show_colcounts = TRUE) %>%\n  split_cols_by(\"VISIT\") %>%\n  split_rows_by(\"ARM\",\n                split_label = \"Treatment arm\",\n                label_pos = \"topleft\") %>%\n  split_rows_by(\"PARAM\",\n                split_label = \"Laboratory test\",\n                label_pos = \"topleft\") %>%\n  analyze(\"AVAL\", var_labels = \"Value (AVAL)\", \n          afun = function(x, .N_col) {\n            in_rows(\n              \"Mean\"   = sprintf(\"%.1f\", mean(x, na.rm = TRUE)),\n              \"Median\" = sprintf(\"%.1f\", median(x, na.rm = TRUE)),\n              \"Q1\"     = sprintf(\"%.1f\", quantile(x, 0.25, na.rm = TRUE)),\n              \"Q3\"     = sprintf(\"%.1f\", quantile(x, 0.75, na.rm = TRUE)),\n              \"Min\"    = sprintf(\"%.1f\", min(x, na.rm = TRUE)),\n              \"Max\"    = sprintf(\"%.1f\", max(x, na.rm = TRUE))\n            )\n          })\n\ntbl_lab <- build_table(tbl_lab, adlb_merged)\n\n# Titles & Footers\nmain_title(tbl_lab) <- \"Laboratory Test Results of Patients with Acquired Immunodeficiency Syndrome (AIDS) by Treatment Arm\"\nsubtitles(tbl_lab) <- \"Summary statistics (Mean, Median, Q1, Q3, Min, Max) for immunological laboratory parameters at each visit\"\nmain_footer(tbl_lab) <- c(\n  \"Mean = arithmetic average; Median = 50th percentile; Q1/Q3 = 25th and 75th percentiles; Min/Max = extreme values.\")\nprov_footer(tbl_lab) <- \"Safety Population includes all randomized patients with AIDS who had laboratory assessments at baseline and follow-up visits.\"\n\ntbl_lab\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLaboratory Test Results of Patients with Acquired Immunodeficiency Syndrome (AIDS) by Treatment Arm\nSummary statistics (Mean, Median, Q1, Q3, Min, Max) for immunological laboratory parameters at each visit\n\n————————————————————————————————————————————————————————————\nTreatment arm                          Baseline   20±5 weeks\n  Laboratory test                      (N=4278)    (N=4278) \n————————————————————————————————————————————————————————————\nZidovudine (ZDV) + Zalcitabine (ZAL)                        \n  CD4+ T-cell Count                                         \n    Mean                                352.8       372.0   \n    Median                              340.0       353.0   \n    Q1                                  260.8       272.0   \n    Q3                                  433.2       458.2   \n    Min                                  99.0        52.0   \n    Max                                 918.0       1100.0  \n  CD8+ T-cell Count                                         \n    Mean                                984.1       901.6   \n    Median                              898.5       862.0   \n    Q1                                  672.2       631.5   \n    Q3                                  1215.5      1094.0  \n    Min                                 105.0       173.0   \n    Max                                 3827.0      2807.0  \nDidanosine (DDI)                                            \n  CD4+ T-cell Count                                         \n    Mean                                347.5       374.3   \n    Median                              340.0       356.0   \n    Q1                                  263.0       270.0   \n    Q3                                  419.0       468.0   \n    Min                                 110.0        74.0   \n    Max                                 911.0       1040.0  \n  CD8+ T-cell Count                                         \n    Mean                                971.9       943.3   \n    Median                              890.0       871.0   \n    Q1                                  648.0       627.0   \n    Q3                                  1180.0      1149.0  \n    Min                                 177.0       131.0   \n    Max                                 5011.0      6035.0  \nZidovudine (ZDV)                                            \n  CD4+ T-cell Count                                         \n    Mean                                353.2       336.1   \n    Median                              346.0       330.5   \n    Q1                                  271.0       243.8   \n    Q3                                  422.0       418.0   \n    Min                                 103.0        49.0   \n    Max                                 771.0       909.0   \n  CD8+ T-cell Count                                         \n    Mean                                987.2       928.2   \n    Median                              881.0       818.0   \n    Q1                                  653.2       626.5   \n    Q3                                  1190.0      1164.0  \n    Min                                 221.0       150.0   \n    Max                                 4255.0      3130.0  \nZidovudine (ZDV) + Didanosine (DDI)                         \n  CD4+ T-cell Count                                         \n    Mean                                348.7       403.2   \n    Median                              336.0       387.0   \n    Q1                                  257.0       285.0   \n    Q3                                  426.0       502.0   \n    Min                                  0.0         80.0   \n    Max                                 1199.0      1119.0  \n  CD8+ T-cell Count                                         \n    Mean                                1004.3      968.0   \n    Median                              917.0       903.0   \n    Q1                                  654.2       650.0   \n    Q3                                  1230.8      1194.5  \n    Min                                  40.0       124.0   \n    Max                                 3389.0      3407.0  \n————————————————————————————————————————————————————————————\n\nMean = arithmetic average; Median = 50th percentile; Q1/Q3 = 25th and 75th percentiles; Min/Max = extreme values.\n\nSafety Population includes all randomized patients with AIDS who had laboratory assessments at baseline and follow-up visits.\n```\n:::\n\n```{.r .cell-code}\n# Create graph to show T cell counts by treatment\n# Average laboratory values by treatment arm\nadlb_summary <- adlb_merged %>%\n  group_by(ARM, PARAM) %>%\n  summarise(mean_val = mean(AVAL, na.rm = TRUE), .groups = \"drop\")\n\n\nggplot(adlb_merged, aes(x = PARAM, y = AVAL, fill = ARM)) +\n  geom_col(data = adlb_summary, aes(x = PARAM, y = mean_val, fill = ARM),\n           position = position_dodge(width = 0.8), alpha = 0.6) +  # barras de média\n  geom_jitter(aes(color = ARM), \n              position = position_jitterdodge(jitter.width = 0.15, dodge.width = 0.8),\n              size = 1, alpha = 0.5, show.legend = FALSE) +  # pontos individuais\n  scale_fill_brewer(palette = \"Set2\") +\n  scale_color_brewer(palette = \"Set2\") +\n  labs(\n    title = \"Mean Laboratory Values and Individual Patient Measurements by Treatment Arm\",\n    x = \"Laboratory Parameter\",\n    y = \"Value\",\n    fill = \"Treatment Arm\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    axis.text.x = element_text(angle = 30, hjust = 1, face = \"bold\"),\n    legend.position = \"top\",\n    legend.title = element_text(face = \"bold\")\n  )\n```\n\n::: {.cell-output-display}\n![](pipeline_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n------------------------------------------------------------------------\n",
    "supporting": [
      "pipeline_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}